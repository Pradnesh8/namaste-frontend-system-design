<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>XSS Example</title>
</head>

<body>
  <!-- Vulnerable Code -->
  <div>
    Welcome, <span id="username"></span>! TimeZone,
    <span id="timezone"></span>!
    <!-- this will get added once attacker does injection -->
    <!-- <img src="does-not-exist" onerror="createPost('ATTACK_TITLE','ATTACK_DESC')" /> -->
  </div>

  <script>
    // Function to set a cookie, mostly this will be set from server
    function setCookie(name, value, days) {
      const date = new Date();
      date.setTime(date.getTime() + days * 24 * 60 * 60 * 1000);
      const expires = "expires=" + date.toUTCString();
      document.cookie = name + "=" + value + ";" + expires + ";path=/";
    }

    // Example: Set a cookie named "exampleCookie" with value "Hello, Cookie!" that expires in 7 days
    setCookie("exampleCookie", "Hello, Cookie!", 7);
  </script>

  <!-- Vulnerable Code -->
  <script>
    const params = new URLSearchParams(window.location.search);
    const name = params.get("name");
    document.getElementById("username").innerHTML = name;
    // Attacker injects the query params as below, attacker puts a script which retrieves and sends the cookie data to other site
    // "http://127.0.0.1:5500/example3.html?name=%3Cimg%20src%3D%22does-not-exist%22%20onerror%3D%22createPost('ATTACK_TITLE'%2C'ATTACK_DESC')%22%20%2F%3E"
  </script>

  <script>
    function createPost(title, description) {
      var xhr = new XMLHttpRequest();
      xhr.open("POST", '/post', true);
      console.log(document.cookie);
      xhr.withCredentials = true;
      xhr.setRequestHeader(
        "Content-type",
        "application/x-www-form-urlencoded"
      );
      xhr.send(`txtName=${title}&mtxMessage=${description}`);
    }
  </script>
</body>

</html>